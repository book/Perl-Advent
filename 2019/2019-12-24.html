<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="WWW::AdventCalendar v1.112" />
    <link rel="alternate" title="Perl Advent Calendar 2019 XML feed" href="atom.xml" type="application/atom+xml" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="2019.css" type="text/css" />
    <title>
Perl Advent Calendar 2019 - 
We Wish You a Meme Christmas

</title>
</head>
<body>
    <div id="contentwrapper">
        <div id="header">
            <h1><a href="index.html">Perl Advent Calendar 2019</a></h1>
        </div>

        <p id="tagline">2019 twenty four merry days of Perl
         <a class='feed' href="atom.xml">Feed</a>
        </p>

        <div id="content">
          

<h1 class='title'>We Wish You a Meme Christmas</h1>
<div class='subtitle'>Imager - 2019-12-24</div>

<div class='pod'><p><center><img src="confession_bear.jpg" alt="Confession Bear Meme: Sometimes I write advent calendar entries for what cool thing it creates rather than how cool the Perl it took to write it is" width="460" height="480"></center>

</p>



<p>It&#39;s true. I&#39;ve featured <a href="http://perladvent.org/2018/2018-12-19.html">cat pictures</a> and <a>animated gifs</a>. I&#39;ve created <a href="http://perladvent.org/2018/2018-12-17.html">Christmas playlists</a>. I&#39;ve shown you images of <a href="http://perladvent.org/2019/2019-12-05.html">Christmas lights</a>. I&#39;ve even had an excuse to <a href="http://perladvent.org/2019/2019-12-08.html">embedded entire Chistmas movies</a>.</p>

<p>Now...it&#39;s finally time to create memes.</p>

<h3 id="Imager">Imager</h3>

<p><a href="https://metacpan.org/module/Imager">Imager</a> is a handy dandy image drawing library in Perl that we&#39;re going to be using for our Meme creation needs.</p>

<p>Imager has about a gazillion methods to do pretty much every standard graphics manipulation you can imagine. But, shockingly, it doesn&#39;t have a way to draw standard meme text (Impact font, white text, black outline.) We can fix that by adding our own plugin:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;<br />55:&nbsp;<br />56:&nbsp;<br />57:&nbsp;<br />58:&nbsp;<br />59:&nbsp;<br />60:&nbsp;<br />61:&nbsp;<br />62:&nbsp;<br />63:&nbsp;<br />64:&nbsp;<br />65:&nbsp;<br />66:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Imager::MemeString</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="float">5.024</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">experimental</span> <span class="single">'signatures'</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Imager</span> <span class="structure">();</span><br /><span class="keyword">use</span> <span class="word">Imager::Font</span> <span class="structure">();</span><br /><br /><span class="comment"># the Imager way is to directly declare functions in the main<br /># 'Imager' namespace.  Here we're using the full package-qualified<br /># syntax for naming a function to place 'meme_string' directly in<br /># the 'Imager' namespace rather than our own.<br /></span><span class="keyword">sub</span> <span class="word">Imager::meme_string</span><span class="prototype">( $img, %args)</span> <span class="structure">{</span><br /><span class="comment">    # meme text is upper case!<br /></span>    <span class="keyword">my</span> <span class="symbol">$string</span> <span class="operator">=</span> <span class="word">uc</span> <span class="word">delete</span> <span class="symbol">$args</span><span class="structure">{</span><span class="word">string</span><span class="structure">};</span><br /><br /><span class="comment">    # Impact is the &quot;classic&quot; font for Memes. This should be the<br />&nbsp;&nbsp;&nbsp;&nbsp;# location for the ttf file on disk - this below is the standard<br />&nbsp;&nbsp;&nbsp;&nbsp;# location on macOS Catalina.<br /></span>    <span class="keyword">my</span> <span class="symbol">$font</span> <span class="operator">=</span> <span class="word">Imager::Font</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">file</span> <span class="operator">=&gt;</span> <span class="single">'/System/Library/Fonts/Supplemental/Impact.ttf'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br /><br /><span class="comment">    # by default text will be centered around the middle of the image<br /></span>    <span class="keyword">my</span> <span class="symbol">$x</span> <span class="operator">=</span> <span class="word">delete</span> <span class="symbol">$args</span><span class="structure">{</span><span class="word">x</span><span class="structure">}</span> <span class="operator">//</span> <span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">getwidth</span> <span class="operator">/</span> <span class="number">2</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$y</span> <span class="operator">=</span> <span class="word">delete</span> <span class="symbol">$args</span><span class="structure">{</span><span class="word">y</span><span class="structure">};</span><br /><br /><span class="comment">    # these are the defaults - you can override this by just<br />&nbsp;&nbsp;&nbsp;&nbsp;# specifying different things in the arguments.<br /></span>    <span class="keyword">my</span> <span class="symbol">%defaults</span> <span class="operator">=</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">font</span> <span class="operator">=&gt;</span> <span class="symbol">$font</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">aa</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">halign</span> <span class="operator">=&gt;</span> <span class="single">'center'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br /><br /><span class="comment">    # We're cheating here.  If we were doing this properly we'd<br />&nbsp;&nbsp;&nbsp;&nbsp;# render the text to a different &quot;layer&quot; image and then use an<br />&nbsp;&nbsp;&nbsp;&nbsp;# algoritm to outline it black.  What we do instead is simplier:<br />&nbsp;&nbsp;&nbsp;&nbsp;# We just draw the same text over and over with horizontal and<br />&nbsp;&nbsp;&nbsp;&nbsp;# vertical offsets.<br /></span>    <span class="keyword">for</span> <span class="keyword">my</span> <span class="symbol">$xoffset</span> <span class="structure">(</span> <span class="number">-3</span> <span class="operator">..</span> <span class="number">3</span> <span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> <span class="keyword">my</span> <span class="symbol">$yoffset</span> <span class="structure">(</span> <span class="number">-3</span> <span class="operator">..</span> <span class="number">3</span><span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">align_string</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">x</span> <span class="operator">=&gt;</span> <span class="symbol">$x</span> <span class="operator">+</span> <span class="symbol">$xoffset</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">y</span> <span class="operator">=&gt;</span> <span class="symbol">$y</span> <span class="operator">+</span> <span class="symbol">$yoffset</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">%defaults</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">%args</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">color</span> <span class="operator">=&gt;</span> <span class="single">'black'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">string</span> <span class="operator">=&gt;</span> <span class="symbol">$string</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><br /><span class="comment">    # draw the same text one last time in white<br /></span>    <span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">align_string</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">x</span> <span class="operator">=&gt;</span> <span class="symbol">$x</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">y</span> <span class="operator">=&gt;</span> <span class="symbol">$y</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">%defaults</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">%args</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">color</span> <span class="operator">=&gt;</span> <span class="single">'white'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">string</span> <span class="operator">=&gt;</span> <span class="symbol">$string</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br /><span class="structure">}</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>Now all we need is a wrapper script that loads our meme template, uses this new method to draw the meme text, and saves it out again:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="comment">#!/usr/bin/perl<br /></span><br /><span class="keyword">use</span> <span class="float">5.024</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Imager</span> <span class="structure">();</span><br /><span class="keyword">use</span> <span class="word">Imager::MemeString</span><span class="structure">();</span><br /><br /><span class="keyword">my</span> <span class="symbol">$template</span> <span class="operator">=</span> <span class="core">shift</span> <span class="operator">or</span> <span class="word">die</span> <span class="single">'Forgot to pass template filename!'</span><span class="structure">;</span><br /><span class="keyword">my</span> <span class="symbol">$output</span>   <span class="operator">=</span> <span class="core">shift</span> <span class="operator">or</span> <span class="word">die</span> <span class="single">'Forgot to pass output filename!'</span><span class="structure">;</span><br /><br /><span class="keyword">my</span> <span class="symbol">$img</span> <span class="operator">=</span> <span class="word">Imager</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">;</span><br /><br /><span class="comment"># Read in the template image. The Imager object will have the same<br /># dimensions as the file we just read in<br /></span><span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">read</span><span class="structure">(</span> <span class="word">file</span> <span class="operator">=&gt;</span> <span class="symbol">$template</span> <span class="structure">)</span> <span class="operator">or</span> <span class="word">die</span> <span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">errstr</span><span class="structure">;</span><br /><br /><span class="comment"># draw the meme string.  Because we're only passing in &quot;y&quot; not &quot;x&quot;<br /># it'll automatically be centred horizontally<br /></span><span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">meme_string</span><span class="structure">(</span> <span class="word">string</span> <span class="operator">=&gt;</span> <span class="double">&quot;Hello, World&quot;</span><span class="operator">,</span> <span class="word">y</span> <span class="operator">=&gt;</span> <span class="number">50</span><span class="operator">,</span> <span class="word">size</span> <span class="operator">=&gt;</span> <span class="number">50</span> <span class="structure">);</span><br /><br /><span class="comment"># and save the new image out<br /></span><span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">write</span><span class="structure">(</span> <span class="word">file</span> <span class="operator">=&gt;</span> <span class="symbol">$output</span><span class="operator">,</span> <span class="word">type</span> <span class="operator">=&gt;</span> <span class="single">'jpeg'</span> <span class="structure">)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="operator">or</span> <span class="word">die</span> <span class="double">&quot;Cannot write: &quot;</span><span class="operator">,</span><span class="symbol">$img</span><span class="operator">-&gt;</span><span class="word">errstr</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>Okay, bring on the memes! (email me links to any you create!)</p>

<p><center><img src="ggg.jpg" alt="Good Guy Greg Meme: Good guy CPAN authors give me lots to write about in Advent Calendar" width="460" height="460"></center>

</p>



<p><center><img src="penguin.jpg" alt="Penguin Awesome-Awkward Meme: Finally completed 24 Advent articles. What'll I do with my free time now?" widthB="460" height="461"></center>

</p>



<p><center><img src="yall.jpg" alt="Y'All Meme: Y'All got any more of those days of advent?" width="460" height="361"></center>

</p>



<p><center><img src="successkid.jpg" alt="Success Kid Meme: Have time to turn best entries into modules" width="460" height="460"></center>

</p>



<p><center><img src="distractedboyfriend.jpg" alt="Distracted Boyfriend Meme: Christmas / Me / Using a computer" width="460" height="307"></center>

</p>



</div>

<div id='author'>
<img alt='Gravatar Image' style='vertical-align:middle' src=http://www.gravatar.com/avatar/5d71b5f0c61e97cd452d625cc24a4c82?r=g&s=80&d=retro />
This article contributed by: Mark Fowler &lt;mark@twoshortplanks.com&gt;
</div>


<ul id="pager">
    <li class="previous"><a title="Testing our Impatience" href="2019-12-23.html">Previous</a></li>

    <li class="next"><a title="Enjoy Christmas" href="2019-12-25.html">Next</a></li>
</ul>
<div style="clear: both"></div>

        </div>

    </div>



</body>
</html>





