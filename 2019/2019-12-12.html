<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="WWW::AdventCalendar v1.112" />
    <link rel="alternate" title="Perl Advent Calendar 2019 XML feed" href="atom.xml" type="application/atom+xml" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="2019.css" type="text/css" />
    <title>
Perl Advent Calendar 2019 - 
Now With Added Interactivity

</title>
</head>
<body>
    <div id="contentwrapper">
        <div id="header">
            <h1><a href="index.html">Perl Advent Calendar 2019</a></h1>
        </div>

        <p id="tagline">2019 twenty four merry days of Perl
         <a class='feed' href="atom.xml">Feed</a>
        </p>

        <div id="content">
          

<h1 class='title'>Now With Added Interactivity</h1>
<div class='subtitle'>GUIDeFATE - 2019-12-12</div>

<div class='pod'><p>Yesterday the Wise Old Elf was <a href="http://perladvent.org/2019/2019-12-10.html">showing</a> a hacky way to quickly throw together a GUI with a touch of HTML, JavaScript and a smattering of Perl code. It was really quick to create a GUI using that - but is there an even quicker, and easier, way?</p>

<h3 id="Introducing-GUIDeFATE">Introducing GUIDeFATE</h3>

<p><a href="https://metacpan.org/module/GUIDeFATE">GUIDeFATE</a> is a Perl GUI &#39;framework&#39; (and I use that word in the loosest possible sense) that&#39;s primary goal is to allow you to quickly throw together a user interface in the least possible time. You sacrifice the precise control that you might have with a traditional framework in order to get something working in minutes.</p>

<p>Let&#39;s rewrite the first dialog example from yesterday. First, as always, we show the finished result: Running</p>

<pre><code>    $ ./guidefate-dialog.pl</code></pre>

<p>Pops up a native looking dialog box:</p>

<p><center><img src="dialogguidefate.jpg" alt="A dialog with text field and OK and Cancel buttons" width='629' height='249'></center>

</p>



<p>Pressing the OK button closes the window and prints our familiar greeting:</p>

<pre><code>    $ ./guidefate-dialog.pl
    Merry Christmas, Wise Old Elf</code></pre>

<p>I bet that was complicated to code, right? Nope, couldn&#39;t be easier - we didn&#39;t even have to really <i>code</i> the GUI bit at all:</p>

<pre><code>    #!/usr/bin/perl

    use 5.024;
    use warnings;

    use GUIDeFATE;

    my $gui = GUIDeFATE-&gt;new(&lt;&lt;&#39;DIALOG&#39;);
    +---------------------------------------+
    |T Merry Christmas Wisher               |
    +M--------------------------------------+
    |  Who?                                 |
    |  [                                  ] |
    |  {   OK   }{ Cancel }                 |
    +---------------------------------------+
    DIALOG

    my $frame = $gui-&gt;getFrame;

    # ok
    sub btn2 {
        my $who = $frame-&gt;getValue(&#39;textctrl1&#39;);
        say &quot;Merry Christmas, $who&quot;;
        $frame-&gt;quit
    }

    # cancel
    sub btn3 { $frame-&gt;quit }

    $gui-&gt;MainLoop;</code></pre>

<p>Rather than specifying the controls with some sort of abstract windowing toolkit, or laying them out with HTML and CSS as happened yesterday, GUIDeFATE takes a different approach: You simply draw out the user interface using ASCII-art. This doesn&#39;t give the same level of control that you might normally want from your GUI toolkit, but what it does allow you to do is quickly create an interface in seconds.</p>

<p>There&#39;s also no explicit mapping of controls to Perl. Controls are named after the type of thing they are. The first control is called &#39;textctrl1&#39; because it&#39;s a text control and the first control. The second control, a button, is &#39;btn2&#39;, the third is &#39;btn3&#39;. Pressing buttons call the subroutines named after the control. It&#39;s all very simple - but you don&#39;t have to even work that out. The quickest way to work out what a button is called is just to press it and read the error message.</p>

<pre><code>    $ ./guidefate-dialog.pl
    Undefined subroutine &amp;main::btn3 called at ./guidefate-dialog.pl line 35.</code></pre>

<p>The quickest way to work out what the name of a text field is is to just print out the contents of all the text fields and take it from there:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">sub</span> <span class="word">show_all_values</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> <span class="structure">(</span><span class="word">keys</span> <span class="cast">%</span><span class="structure">{</span> <span class="symbol">$frame</span> <span class="structure">})</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$control</span> <span class="operator">=</span> <span class="symbol">$frame</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="magic">$_</span><span class="structure">};</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">say</span> <span class="double">&quot;$_: &quot;</span><span class="operator">.</span><span class="symbol">$control</span><span class="operator">-&gt;</span><span class="word">GetValue</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">if</span> <span class="symbol">$control</span> <span class="operator">&amp;&amp;</span> <span class="symbol">$control</span><span class="operator">-&gt;</span><span class="word">can</span><span class="structure">(</span><span class="single">'GetValue'</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><span class="structure">}</span></code><br />&nbsp;</td></table>

<h3 id="But-I-liked-the-Browser">But I liked the Browser!</h3>

<p>In the above example GUIDeFATE was using the cross platform Wx graphics toolkit library. This means that the same code <i>should</i> run Linux, macOS, and even Windows. But Wx can be a little tricky to install if you don&#39;t have precompiled binaries to hand (I&#39;ve been doing Perl for over twenty five years and it took me a few hours to wrestle it into submission using the latest versions of Perl and macOS.) The browser based solution we had yesterday didn&#39;t have that same level of complex dependencies.</p>

<p>Luckily, GUIDeFATE isn&#39;t tied to any one underlying toolkit. It actually support <i>seven</i> different backends - Wx, Tk, Gtk, Qt, Win32, HTML and Websocket. Switching to &#39;Tk&#39; is as simple as passing an extra argument to the constructor</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">my</span> <span class="symbol">$gui</span> <span class="operator">=</span> <span class="word">GUIDeFATE</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="heredoc">&lt;&lt;'DIALOG'</span><span class="operator">,</span> <span class="single">'tk'</span><span class="structure">);</span><br /><span class="heredoc_content">...</span><span class="heredoc_terminator">DIALOG<br /></span></code><br />&nbsp;</td></table>

<p>Or even ask it to just render in the browser:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">my</span> <span class="symbol">$gui</span> <span class="operator">=</span> <span class="word">GUIDeFATE</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="heredoc">&lt;&lt;'DIALOG'</span><span class="operator">,</span> <span class="single">'web'</span> <span class="structure">);</span><br /><span class="heredoc_content">...</span><span class="heredoc_terminator">DIALOG<br /></span></code><br />&nbsp;</td></table>

<p>Like so:</p>

<p><center><img src="guidefatews.jpg" alt="A dialog with text field and OK and Cancel buttons in a web browser" width='661' height='384'></center>

</p>



<p>Clicking OK prints out the message as before - no further code changes were necessary.</p>

<h3 id="A-More-Complex-Example">A More Complex Example</h3>

<p>For good measure here&#39;s a straight port of the code I wrote yesterday for editing notes.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;<br />55:&nbsp;<br />56:&nbsp;<br />57:&nbsp;<br />58:&nbsp;<br />59:&nbsp;<br />60:&nbsp;<br />61:&nbsp;<br />62:&nbsp;<br />63:&nbsp;<br />64:&nbsp;<br />65:&nbsp;<br />66:&nbsp;<br />67:&nbsp;<br />68:&nbsp;<br />69:&nbsp;<br />70:&nbsp;<br />71:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="comment">#!/usr/bin/perl<br /></span><br /><span class="keyword">use</span> <span class="float">5.024</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">GUIDeFATE</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">Path::Tiny</span>    <span class="words">qw( path )</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">List::UtilsBy</span> <span class="words">qw( min_by )</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">File::Copy</span>    <span class="words">qw( move )</span><span class="structure">;</span><br /><br /><span class="keyword">my</span> <span class="symbol">$gui</span> <span class="operator">=</span> <span class="word">GUIDeFATE</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="heredoc">&lt;&lt;'DIALOG'</span> <span class="structure">);</span><br /><span class="heredoc_content">+---------------------------------------+<br />|T Note Processor                       |<br />+M--------------------------------------+<br />|[                                     ]|<br />|+T------------------------------------+|<br />||                                     ||<br />||                                     ||<br />||                                     ||<br />||                                     ||<br />||                                     ||<br />||                                     ||<br />||                                     ||<br />||                                     ||<br />|+-------------------------------------+|<br />|{ Archive }                    { Save }|<br />+---------------------------------------+<br /></span><span class="heredoc_terminator">DIALOG<br /></span><span class="keyword">my</span> <span class="symbol">$frame</span> <span class="operator">=</span> <span class="symbol">$gui</span><span class="operator">-&gt;</span><span class="word">getFrame</span><span class="structure">;</span><br /><br /><span class="comment"># where the files are kept<br /></span><span class="keyword">my</span> <span class="symbol">$notes_dir</span>   <span class="operator">=</span> <span class="word">path</span><span class="structure">(</span><span class="symbol">$ENV</span><span class="structure">{</span><span class="word">HOME</span><span class="structure">}</span><span class="operator">,</span> <span class="single">'notes'</span><span class="structure">);</span><br /><span class="keyword">my</span> <span class="symbol">$archive_dir</span> <span class="operator">=</span> <span class="word">path</span><span class="structure">(</span><span class="symbol">$ENV</span><span class="structure">{</span><span class="word">HOME</span><span class="structure">}</span><span class="operator">,</span> <span class="single">'.archived-notes'</span><span class="structure">);</span><br /><br /><span class="comment"># this is the current file we're working on<br /></span><span class="keyword">my</span> <span class="symbol">$file</span><span class="structure">;</span><br /><br /><span class="keyword">sub</span> <span class="word">next_note</span> <span class="prototype">()</span> <span class="structure">{</span><br /><span class="comment">    # find the oldest file to work on <br /></span>    <span class="symbol">$file</span> <span class="operator">=</span> <span class="word">min_by</span> <span class="structure">{</span> <span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">stat</span><span class="operator">-&gt;</span><span class="word">mtime</span> <span class="structure">}</span> <span class="symbol">$notes_dir</span><span class="operator">-&gt;</span><span class="word">children</span><span class="structure">;</span><br /><br /><span class="comment">    # update the form in the browser<br />&nbsp;&nbsp;&nbsp;&nbsp;# title is the filename (without dir nor extension)<br /></span>    <span class="symbol">$frame</span><span class="operator">-&gt;</span><span class="word">setValue</span><span class="structure">(</span><span class="single">'textctrl0'</span><span class="operator">,</span> <span class="symbol">$file</span><span class="operator">-&gt;</span><span class="word">basename</span><span class="structure">(</span><span class="regexp">qr/.txt/</span><span class="structure">));</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$frame</span><span class="operator">-&gt;</span><span class="word">setValue</span><span class="structure">(</span><span class="single">'TextCtrl2'</span><span class="operator">,</span> <span class="symbol">$file</span><span class="operator">-&gt;</span><span class="word">slurp_utf8</span> <span class="structure">);</span><br /><span class="structure">}</span><br /><br /><span class="comment"># archive clicked<br /></span><span class="keyword">sub</span> <span class="word">btn3</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">move</span><span class="structure">(</span><span class="symbol">$file</span><span class="operator">,</span> <span class="double">&quot;$ENV{HOME}/.notes-archive&quot;</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">next_note</span><span class="structure">();</span><br /><span class="structure">};</span><br /><br /><span class="comment"># save clicked<br /></span><span class="keyword">sub</span> <span class="word">btn4</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$title</span>    <span class="operator">=</span> <span class="symbol">$frame</span><span class="operator">-&gt;</span><span class="word">getValue</span><span class="structure">(</span><span class="single">'textctrl0'</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$contents</span> <span class="operator">=</span> <span class="symbol">$frame</span><span class="operator">-&gt;</span><span class="word">getValue</span><span class="structure">(</span><span class="single">'TextCtrl2'</span><span class="structure">);</span> <br /><br /><span class="comment">    # write the note out, possibly in a new location<br /></span>    <span class="word">path</span><span class="structure">(</span> <span class="symbol">$notes_dir</span><span class="operator">,</span> <span class="symbol">$title</span> <span class="operator">.</span> <span class="single">'.txt'</span><span class="structure">)</span><span class="operator">-&gt;</span><span class="word">spew_utf8</span><span class="structure">(</span> <span class="symbol">$contents</span> <span class="structure">);</span><br /><br /><span class="comment">    # if we renamed the note delete the old note<br /></span>    <span class="keyword">if</span> <span class="structure">(</span><span class="symbol">$title</span> <span class="operator">ne</span> <span class="symbol">$file</span><span class="operator">-&gt;</span><span class="word">basename</span><span class="structure">(</span><span class="regexp">qr/.txt/</span><span class="structure">))</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">unlink</span> <span class="symbol">$file</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">next_note</span><span class="structure">();</span><br /><span class="structure">}</span><br /><br /><span class="word">next_note</span><span class="structure">();</span><br /><span class="symbol">$gui</span><span class="operator">-&gt;</span><span class="word">MainLoop</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>While not as colorful as the HTML version, it presents a simple functional interface:</p>

<p><center><img src="noteproc.jpg" alt="Screenshot of editor instance" widht="632" height="478"></center>

</p>



<p>We can easily flesh this out just a little more. For example, we can add confirmation for archiving:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="comment"># archive clicked<br /></span><span class="keyword">sub</span> <span class="word">btn3</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> <span class="structure">(</span><span class="symbol">$frame</span><span class="operator">-&gt;</span><span class="word">showDialog</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;Sure?&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;Are you sure you want to archive?&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;OKC&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;!&quot;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">){</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">move</span><span class="structure">(</span><span class="symbol">$file</span><span class="operator">,</span> <span class="double">&quot;$ENV{HOME}/.notes-archive&quot;</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">next_note</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><span class="structure">};</span></code><br />&nbsp;</td></table>

<p><center><img src="confirm.jpg" alt="confirmation dialog" width="532" height="263"></center>

</p>



<p>GUIDeFATE has a bunch of handy things to make quick output really simple - file dialogs, menus, and a collection of other widgets that I haven&#39;t shown here. I encourage you to have a play with it - it&#39;ll only take a minute or two to write your first app!</p>

</div>

<div id='author'>
<img alt='Gravatar Image' style='vertical-align:middle' src=http://www.gravatar.com/avatar/5d71b5f0c61e97cd452d625cc24a4c82?r=g&s=80&d=retro />
This article contributed by: Mark Fowler &lt;mark@twoshortplanks.com&gt;
</div>


<ul id="pager">
    <li class="previous"><a title="Now With Added Interactivity" href="2019-12-11.html">Previous</a></li>

    <li class="next"><a title="Draft Solution" href="2019-12-13.html">Next</a></li>
</ul>
<div style="clear: both"></div>

        </div>

    </div>



</body>
</html>





