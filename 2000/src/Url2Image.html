<html>
<head>
<BASE HREF="http://twoshortplanks.com/xmas/src/Url2Image.html">

  <title>/home/mark/public_html/f/Url2Image.pm</title>
</head>
<body bgcolor="#ffffff" text="#000000">
<pre>
<strong>package</strong> Url2Image;

<strong>use</strong> GD;
<strong>use</strong> strict;

<strong>sub<font color="ff0000"> new</font>
{</font>
    <font color="a52a2a"><strong>chdir</strong></font> <font color="#008000">&quot;/virtual/twoshortplanks.com/www/html/f/&quot;</font> <strong>or</strong> <strong>die</strong> <font color="#008000">&quot;Can't change to working DIR&quot;</font>;

    <strong>my</strong> <font color="#2040a0">$class</font> = <font color="a52a2a"><strong>shift</strong></font>;
    <strong>my</strong> <font color="#2040a0">$style</font> = <font color="a52a2a"><strong>shift</strong></font>;
    <strong>my</strong> <font color="#2040a0">$text</font> = <font color="a52a2a"><strong>shift</strong></font>;

    <font color="#444444"># create the object with default values
    </font><strong>my</strong> <font color="#2040a0">$this</font> = <font color="4444FF"><strong>[</strong></font><font color="#2040a0">$style</font>,<font color="#2040a0">$text</font>,<font color="4444FF"><strong>{</strong></font>
                               <font color="#444444"># text apreance

			       </font>FACE =&gt; <font color="#008000">&quot;cinema&quot;</font>, 
			       SIZE =&gt; 12.0,

	                       FG_R =&gt; 255,
	                       FG_G =&gt; 255,
	                       FG_B =&gt; 255,

			       <font color="#444444"># text postion

			       </font>WIDTH  =&gt; <font color="#008000">&quot;TEXT&quot;</font>,   
     		               HEIGHT =&gt; <font color="#008000">&quot;TEXT&quot;</font>,

			       ALIGNMENT =&gt; <font color="#008000">&quot;LEFT&quot;</font>,
			       V_ALIGNMENT =&gt; <font color="#008000">&quot;BELOW&quot;</font>,

			       AT_X =&gt; 0,
			       AT_Y =&gt; 0,

			       <font color="#444444"># the border

			       </font>BD_WIDTH =&gt; 0,

	                       BD_R =&gt; 255,
	                       BD_G =&gt; 255,
	                       BD_B =&gt; 255,
			      
			       <font color="#444444"># the background
			       
	                       </font>BG_R =&gt; 0,
	                       BG_G =&gt; 0,
	                       BG_B =&gt; 0,

			       BG_IMAGE =&gt; <font color="a52a2a"><strong>undef</strong></font>,

			       BG_AT_X =&gt; 0,
			       BG_AT_Y =&gt; 0,

			       BG_ALIGNMENT   =&gt; <font color="#008000">&quot;LEFT&quot;</font>,
			       BG_V_ALIGNMENT =&gt; <font color="#008000">&quot;BELOW&quot;</font>,

			       <font color="#444444"># the output format

			       </font>OUTPUT =&gt; <font color="#008000">&quot;PNG&quot;</font>

                             <font color="4444FF"><strong>}</strong></font>,<font color="4444FF"><strong>]</strong></font>;

    <font color="#444444"># our father, who art in heaven...
    </font><font color="a52a2a"><strong>bless</strong></font> <font color="#2040a0">$this</font>, <font color="#2040a0">$class</font>;

    <font color="#444444"># read in the config options from the file, possibly
    # overwriting the default values
    </font><font color="#2040a0">$this</font>-&gt;read_config_file;

    <font color="#444444"># cache the image to memory
    </font><font color="#2040a0">$this</font>-&gt;create_image;

    <font color="#444444"># return the object.
    </font><font color="#2040a0">$this</font>
<font color="4444FF"><strong>}</strong></font>

<font color="#444444"># reads the config file from the correct place
# given what the style is
</font><strong>sub<font color="ff0000"> read_config_file</font>
{</font>
    <strong>my</strong> <font color="#2040a0">$this</font> = <font color="a52a2a"><strong>shift</strong></font>;

    <font color="#444444"># get the style
    </font><strong>my</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$style</font><font color="4444FF"><strong>)</strong></font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>0<font color="4444FF"><strong>]</strong></font> =~<font color="b000d0"> /^([A-Za-z0-9_]*)$/</font>;

    <font color="a52a2a"><strong>open</strong></font> <font color="4444FF"><strong>(</strong></font>CONFIG, <font color="#008000">&quot;<font color="#2040a0">$style</font>/.fontrc&quot;</font><font color="4444FF"><strong>)</strong></font> <strong>or</strong> <strong>return</strong>;
    <strong>while</strong> <font color="4444FF"><strong>(</strong></font>&lt;CONFIG&gt;<font color="4444FF"><strong>)</strong></font>
    <font color="4444FF"><strong>{</strong></font>
	<font color="a52a2a"><strong>chomp</strong></font>;              <font color="#444444"># no newlines
	</font><font color="b000d0">s/#.*//</font>;            <font color="#444444"># no comments
	</font><font color="b000d0">s/^\s+//</font>;           <font color="#444444"># no start whitespace
	</font><font color="b000d0">s/\s+$//</font>;           <font color="#444444"># no end whitespace
	</font><strong>next</strong> <strong>unless</strong> <font color="a52a2a"><strong>length</strong></font>; <font color="#444444"># anything left? 
	</font><strong>my</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$var</font>, <font color="#2040a0">$value</font><font color="4444FF"><strong>)</strong></font> = <font color="a52a2a"><strong>split</strong></font> <font color="4444FF"><strong>(</strong></font><font color="b000d0">/\s*=\s*/</font>,<font color="#2040a0">$_</font>,2<font color="4444FF"><strong>)</strong></font>;
	<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font>-&gt;<font color="4444FF"><strong>{</strong></font><font color="#2040a0">$var</font><font color="4444FF"><strong>}</strong></font> = <font color="#2040a0">$value</font>;
    <font color="4444FF"><strong>}</strong></font>
    <font color="a52a2a"><strong>close</strong></font> CONFIG;
<font color="4444FF"><strong>}</strong></font>

<strong>sub<font color="ff0000"> print</font>
{</font>
  <strong>my</strong> <font color="#2040a0">$this</font> = <font color="a52a2a"><strong>shift</strong></font>;
  <font color="a52a2a"><strong>binmode</strong></font> STDOUT;

  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>OUTPUT<font color="4444FF"><strong>}</strong></font> <strong>eq</strong> <font color="#008000">'PNG'</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="a52a2a"><strong>print</strong></font> <font color="#008000">&quot;Content-type: image/png<font color="#77dd77">\n</font><font color="#77dd77">\n</font>&quot;</font>;
      <font color="a52a2a"><strong>print</strong></font> <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>3<font color="4444FF"><strong>]</strong></font>-&gt;png;
  <font color="4444FF"><strong>}</strong></font>
  <strong>else</strong>
  <font color="4444FF"><strong>{</strong></font>
    <font color="a52a2a"><strong>print</strong></font> <font color="#008000">&quot;Content-type: image/jpeg<font color="#77dd77">\n</font><font color="#77dd77">\n</font>&quot;</font>;
    <font color="a52a2a"><strong>print</strong></font> <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>3<font color="4444FF"><strong>]</strong></font>-&gt;jpeg;
  <font color="4444FF"><strong>}</strong></font>
<font color="4444FF"><strong>}</strong></font>

<strong>sub<font color="ff0000"> get_string</font>
{</font>
    <strong>my</strong> <font color="#2040a0">$this</font> = <font color="a52a2a"><strong>shift</strong></font>;
    <font color="#2040a0">$_</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>1<font color="4444FF"><strong>]</strong></font>;

   <font color="b000d0"> s/_/ /g</font>;
    s<font color="b000d0">/&amp;([0-9]+);/</font><font color="a52a2a"><strong>chr</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font><font color="4444FF"><strong>)</strong></font>/ge;
   <font color="b000d0"> s/&amp;slash;/\/</font>/g;
   <font color="b000d0"> s/&amp;nbsp;/ /g</font>;
   <font color="b000d0"> s/&amp;lt;/&lt;/g</font>;
   <font color="b000d0"> s/&amp;gt;/&gt;/g</font>;
   <font color="b000d0"> s/&amp;quote;/&quot;/g</font>; <font color="#444444">#&quot;
    </font><font color="b000d0">s/&amp;amp;/&amp;/g</font>;

    <font color="#444444"># certain ends overide the default...
    </font><strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="b000d0">s/.png$//</font><font color="4444FF"><strong>)</strong></font> <font color="4444FF"><strong>{</strong></font> <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>OUTPUT<font color="4444FF"><strong>}</strong></font> = <font color="#008000">&quot;PNG&quot;</font> ; <strong>return</strong> <font color="#2040a0">$_</font><font color="4444FF"><strong>}</strong></font>
    <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="b000d0">s/.jpg$//</font><font color="4444FF"><strong>)</strong></font> <font color="4444FF"><strong>{</strong></font> <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>OUTPUT<font color="4444FF"><strong>}</strong></font> = <font color="#008000">&quot;JPG&quot;</font> ; <strong>return</strong> <font color="#2040a0">$_</font><font color="4444FF"><strong>}</strong></font>

    <strong>return</strong> <font color="#2040a0">$_</font>;
<font color="4444FF"><strong>}</strong></font>

<strong>sub<font color="ff0000"> create_image</font>
{</font>
  <strong>my</strong> <font color="#2040a0">$this</font> = <font color="a52a2a"><strong>shift</strong></font>;
  <strong>my</strong> <font color="#2040a0">$text</font> = <font color="#2040a0">$this</font>-&gt;get_string;
  <strong>my</strong> <font color="#2040a0">$font</font> = <font color="#008000">&quot;fonts/<font color="#2040a0">$this</font>-&gt;[2]{FACE}.ttf&quot;</font>;

  <font color="#444444"># work out the size of the font

  </font><strong>my</strong> <font color="#2040a0">@bounds</font> = GD::Image-&gt;stringTTF<font color="4444FF"><strong>(</strong></font>0,<font color="#2040a0">$font</font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>SIZE<font color="4444FF"><strong>}</strong></font>,0,0,0,<font color="#2040a0">$text</font><font color="4444FF"><strong>)</strong></font>;
  <strong>die</strong> <font color="#008000">&quot;couldn't find font!&quot;</font> <strong>unless</strong> <font color="4444FF"><strong>(</strong></font><font color="a52a2a"><strong>defined</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">@bounds</font><font color="4444FF"><strong>)</strong></font><font color="4444FF"><strong>)</strong></font>;

  <strong>my</strong> <font color="#2040a0">$text_width</font>  = <font color="#2040a0">$bounds</font><font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font>+1;
  <strong>my</strong> <font color="#2040a0">$text_height</font> = <font color="#2040a0">$bounds</font><font color="4444FF"><strong>[</strong></font>3<font color="4444FF"><strong>]</strong></font>-<font color="#2040a0">$bounds</font><font color="4444FF"><strong>[</strong></font>7<font color="4444FF"><strong>]</strong></font>+2;

  <font color="#444444"># load the background image if there is one

  </font><strong>my</strong> <font color="#2040a0">$bg_image</font>;
  <strong>my</strong> <font color="#2040a0">$bg_width</font>;
  <strong>my</strong> <font color="#2040a0">$bg_height</font>;

  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_IMAGE<font color="4444FF"><strong>}</strong></font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font> 
      <font color="#2040a0">$bg_image</font> = GD::Image-&gt;<strong>new</strong><font color="4444FF"><strong>(</strong></font><font color="#008000">&quot;images/&quot;</font> . <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_IMAGE<font color="4444FF"><strong>}</strong></font><font color="4444FF"><strong>)</strong></font> <strong>or</strong> <strong>die</strong> <font color="#008000">&quot;Can't load image <font color="#2040a0">$this</font>-&gt;[2]{BG_IMAGE}&quot;</font>;
      <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$bg_width</font>,<font color="#2040a0">$bg_height</font><font color="4444FF"><strong>)</strong></font> = <font color="#2040a0">$bg_image</font>-&gt;getBounds<font color="4444FF"><strong>(</strong></font><font color="4444FF"><strong>)</strong></font>;
  <font color="4444FF"><strong>}</strong></font>


  <font color="#444444"># define the width 

  </font><strong>my</strong> <font color="#2040a0">$width</font>;

  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font>-&gt;<font color="4444FF"><strong>{</strong></font>WIDTH<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^IMAGE/</font><font color="4444FF"><strong>)</strong></font>  
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$width</font> = <font color="#2040a0">$bg_width</font>; 
      <font color="#2040a0">$'</font> =~<font color="b000d0"> m#(\+|-)(.*)$#</font>;
      <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font> <strong>eq</strong> <font color="#008000">'+'</font><font color="4444FF"><strong>)</strong></font> 
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$width</font> += <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
	  <strong>else</strong>
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$width</font> -= <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
      <font color="4444FF"><strong>}</strong></font>
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font>-&gt;<font color="4444FF"><strong>{</strong></font>WIDTH<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^TEXT/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$width</font> = <font color="#2040a0">$text_width</font>;

      <font color="#2040a0">$'</font> =~<font color="b000d0"> m#(\+|-)(.*)$#</font>;
      <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font> <strong>eq</strong> <font color="#008000">'+'</font><font color="4444FF"><strong>)</strong></font> 
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$width</font> += <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
	  <strong>else</strong>
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$width</font> -= <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
      <font color="4444FF"><strong>}</strong></font>
  <font color="4444FF"><strong>}</strong></font>
  <strong>else</strong>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$width</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>WIDTH<font color="4444FF"><strong>}</strong></font> +0;
  <font color="4444FF"><strong>}</strong></font>  

  <font color="#444444"># define the height

  </font><strong>my</strong> <font color="#2040a0">$height</font>;

  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font>-&gt;<font color="4444FF"><strong>{</strong></font>HEIGHT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^IMAGE/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$height</font> = <font color="#2040a0">$bg_height</font>;
      <font color="#2040a0">$'</font> =~<font color="b000d0"> m#(\+|-)(.*)$#</font>;
      <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font> <strong>eq</strong> <font color="#008000">'+'</font><font color="4444FF"><strong>)</strong></font> 
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$height</font> += <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
	  <strong>else</strong>
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$height</font> -= <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
      <font color="4444FF"><strong>}</strong></font>
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font>-&gt;<font color="4444FF"><strong>{</strong></font>HEIGHT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^TEXT/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$height</font> = <font color="#2040a0">$text_height</font>;

       <font color="#2040a0">$'</font> =~<font color="b000d0"> m#(\+|-)(.*)$#</font>;
      <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$1</font> <strong>eq</strong> <font color="#008000">'+'</font><font color="4444FF"><strong>)</strong></font> 
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$height</font> += <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
	  <strong>else</strong>
	    <font color="4444FF"><strong>{</strong></font><font color="#2040a0">$height</font> -= <font color="#2040a0">$2</font><font color="4444FF"><strong>}</strong></font>
      <font color="4444FF"><strong>}</strong></font>
  <font color="4444FF"><strong>}</strong></font>
  <strong>else</strong>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$height</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>HEIGHT<font color="4444FF"><strong>}</strong></font> +0;
  <font color="4444FF"><strong>}</strong></font>

  <font color="#444444"># create the image
  </font><strong>my</strong> <font color="#2040a0">$image</font> = <strong>new</strong> GD::Image<font color="4444FF"><strong>(</strong></font><font color="#2040a0">$width</font>, <font color="#2040a0">$height</font><font color="4444FF"><strong>)</strong></font>;

  <font color="#444444"># make the colours
  </font><strong>my</strong> <font color="#2040a0">$background</font> = <font color="#2040a0">$image</font>-&gt;colorAllocate<font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_R<font color="4444FF"><strong>}</strong></font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_G<font color="4444FF"><strong>}</strong></font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_B<font color="4444FF"><strong>}</strong></font><font color="4444FF"><strong>)</strong></font>;
  <strong>my</strong> <font color="#2040a0">$foreground</font> = <font color="#2040a0">$image</font>-&gt;colorAllocate<font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>FG_R<font color="4444FF"><strong>}</strong></font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>FG_G<font color="4444FF"><strong>}</strong></font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>FG_B<font color="4444FF"><strong>}</strong></font><font color="4444FF"><strong>)</strong></font>;
  <strong>my</strong> <font color="#2040a0">$border</font>     = <font color="#2040a0">$image</font>-&gt;colorAllocate<font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BD_R<font color="4444FF"><strong>}</strong></font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BD_G<font color="4444FF"><strong>}</strong></font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BD_B<font color="4444FF"><strong>}</strong></font><font color="4444FF"><strong>)</strong></font>;

  <font color="#444444"># paste the background image if there is one
  </font><strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$bg_image</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <strong>my</strong> <font color="#2040a0">$bgx</font>;
      <strong>my</strong> <font color="#2040a0">$bgy</font>;

      <font color="#444444"># we have control of the horizontal
      </font><strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^RIGHT$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgx</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_X<font color="4444FF"><strong>}</strong></font> - <font color="#2040a0">$bg_width</font>;
      <font color="4444FF"><strong>}</strong></font>
      <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgx</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_X<font color="4444FF"><strong>}</strong></font> - <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$bg_width</font>/2<font color="4444FF"><strong>)</strong></font>;
      <font color="4444FF"><strong>}</strong></font>
      <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^IMAGE_CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgx</font> = <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$width</font><font color="b000d0">/2 - $bg_width/</font>2<font color="4444FF"><strong>)</strong></font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_X<font color="4444FF"><strong>}</strong></font>;
      <font color="4444FF"><strong>}</strong></font>
      <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^FLUSH_RIGHT$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgx</font> = <font color="#2040a0">$width</font> - <font color="#2040a0">$bg_width</font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_X<font color="4444FF"><strong>}</strong></font>;
      <font color="4444FF"><strong>}</strong></font>
      <strong>else</strong>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgx</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_X<font color="4444FF"><strong>}</strong></font>;
      <font color="4444FF"><strong>}</strong></font>

      <font color="#444444"># and the vertical - do not adjust your set
      </font><strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^ABOVE$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgy</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_Y<font color="4444FF"><strong>}</strong></font> - <font color="#2040a0">$bg_height</font>;
      <font color="4444FF"><strong>}</strong></font>
      <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgy</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_Y<font color="4444FF"><strong>}</strong></font> - <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$bg_height</font>/2<font color="4444FF"><strong>)</strong></font>;
      <font color="4444FF"><strong>}</strong></font>
      <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^IMAGE_CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgy</font> = <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$height</font><font color="b000d0">/2 - $bg_height/</font>2<font color="4444FF"><strong>)</strong></font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_Y<font color="4444FF"><strong>}</strong></font> ;
      <font color="4444FF"><strong>}</strong></font>
      <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^FLUSH_BOTTOM$/</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgy</font> = <font color="#2040a0">$height</font> - <font color="#2040a0">$bg_height</font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_Y<font color="4444FF"><strong>}</strong></font>;
      <font color="4444FF"><strong>}</strong></font>
      <strong>else</strong>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$bgy</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_Y<font color="4444FF"><strong>}</strong></font>;
      <font color="4444FF"><strong>}</strong></font>
      
      <font color="#444444"># actually copy across the image (cross fingers)
      </font><font color="#2040a0">$image</font>-&gt;copy<font color="4444FF"><strong>(</strong></font><font color="#2040a0">$bg_image</font>,<font color="#2040a0">$bgx</font>,<font color="#2040a0">$bgy</font>,0,0,<font color="#2040a0">$bg_width</font>,<font color="#2040a0">$bg_height</font><font color="4444FF"><strong>)</strong></font>;
  <font color="4444FF"><strong>}</strong></font>

  <font color="#444444"># work out where the text is going to go

  </font><strong>my</strong> <font color="#2040a0">$x</font>;
  <strong>my</strong> <font color="#2040a0">$y</font>;

  <font color="#444444"># we have control of the horizontal
  </font><strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^RIGHT$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$x</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_X<font color="4444FF"><strong>}</strong></font> - <font color="#2040a0">$text_width</font>;
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$x</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_X<font color="4444FF"><strong>}</strong></font> - <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$width</font>/2<font color="4444FF"><strong>)</strong></font>;
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^IMAGE_CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$x</font> = <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$width</font><font color="b000d0">/2 - $text_width/</font>2<font color="4444FF"><strong>)</strong></font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_X<font color="4444FF"><strong>}</strong></font>;
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^FLUSH_RIGHT$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$x</font> = <font color="#2040a0">$width</font> - <font color="#2040a0">$text_width</font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_X<font color="4444FF"><strong>}</strong></font>;
  <font color="4444FF"><strong>}</strong></font>
  <strong>else</strong>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$x</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_X<font color="4444FF"><strong>}</strong></font>;
  <font color="4444FF"><strong>}</strong></font>

  <font color="#444444"># and the vertical - do not adjust your set
  </font><strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^ABOVE$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$y</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_Y<font color="4444FF"><strong>}</strong></font> - <font color="#2040a0">$text_height</font>;
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$y</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_Y<font color="4444FF"><strong>}</strong></font> - <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$text_height</font>/2<font color="4444FF"><strong>)</strong></font>;
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^IMAGE_CENT(ER|RE)$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$y</font> = <font color="a52a2a"><strong>int</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$height</font><font color="b000d0">/2 - $text_height/</font>2<font color="4444FF"><strong>)</strong></font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_Y<font color="4444FF"><strong>}</strong></font> ;
  <font color="4444FF"><strong>}</strong></font>
  <strong>elsif</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>V_ALIGNMENT<font color="4444FF"><strong>}</strong></font> =~<font color="b000d0"> /^FLUSH_BOTTOM$/</font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$y</font> = <font color="#2040a0">$height</font> - <font color="#2040a0">$text_height</font> + <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>AT_Y<font color="4444FF"><strong>}</strong></font>;
  <font color="4444FF"><strong>}</strong></font>
  <strong>else</strong>
  <font color="4444FF"><strong>{</strong></font>
      <font color="#2040a0">$y</font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BG_AT_Y<font color="4444FF"><strong>}</strong></font>;
  <font color="4444FF"><strong>}</strong></font>
      
  <font color="#444444"># finally draw the text
  </font><strong>my</strong> <font color="#2040a0">@bounds</font> = <font color="#2040a0">$image</font>-&gt;stringTTF<font color="4444FF"><strong>(</strong></font><font color="#2040a0">$foreground</font>,<font color="#2040a0">$font</font>,<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>SIZE<font color="4444FF"><strong>}</strong></font>,0,<font color="#2040a0">$x</font>,<font color="#2040a0">$y</font>-<font color="#2040a0">$bounds</font><font color="4444FF"><strong>[</strong></font>7<font color="4444FF"><strong>]</strong></font>,<font color="#2040a0">$text</font><font color="4444FF"><strong>)</strong></font>

       <strong>or</strong> <strong>die</strong> <font color="#008000">&quot;Coundn't write text <font color="#2040a0">$text</font>&quot;</font>;

  <font color="#444444"># do the border
  </font><strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BD_WIDTH<font color="4444FF"><strong>}</strong></font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <strong>foreach</strong> <font color="4444FF"><strong>(</strong></font>0..<font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>BD_WIDTH<font color="4444FF"><strong>}</strong></font>-1<font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="#2040a0">$image</font>-&gt;rectangle<font color="4444FF"><strong>(</strong></font><font color="#2040a0">$_</font>,<font color="#2040a0">$_</font>,<font color="#2040a0">$width</font>-<font color="#2040a0">$_</font>-1,<font color="#2040a0">$height</font>-<font color="#2040a0">$_</font>-1,<font color="#2040a0">$border</font><font color="4444FF"><strong>)</strong></font>;
      <font color="4444FF"><strong>}</strong></font>
  <font color="4444FF"><strong>}</strong></font>

  <font color="#444444"># extract the name of the file
  </font><strong>my</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$style</font><font color="4444FF"><strong>)</strong></font> = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>0<font color="4444FF"><strong>]</strong></font> =~<font color="b000d0"> /^([A-Za-z0-9_]*)$/</font>;
  <strong>my</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$txt</font><font color="4444FF"><strong>)</strong></font>   = <font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>1<font color="4444FF"><strong>]</strong></font> =~<font color="b000d0"> /^([+-=A-Za-z0-9_&amp;;\[\]:&quot;'()]*)$/</font>; <font color="#444444"># &quot;;

  # check we got a legal filename out
  </font><strong>die</strong> <strong>unless</strong> <font color="4444FF"><strong>(</strong></font><font color="a52a2a"><strong>length</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$style</font><font color="4444FF"><strong>)</strong></font> &amp;&amp; <font color="a52a2a"><strong>length</strong></font><font color="4444FF"><strong>(</strong></font><font color="#2040a0">$txt</font><font color="4444FF"><strong>)</strong></font><font color="4444FF"><strong>)</strong></font>;

  <font color="#444444"># check we're not overwriting a dot file (v. bad)
  </font><strong>die</strong> <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$txt</font> =~<font color="b000d0"> /^\./</font><font color="4444FF"><strong>)</strong></font>;

  <font color="#444444"># save to the correct file.  This probably shouldn't be hardcoded.   			       

  </font><strong>unless</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>NO_WRITE<font color="4444FF"><strong>}</strong></font><font color="4444FF"><strong>)</strong></font>
  <font color="4444FF"><strong>{</strong></font>
      <font color="a52a2a"><strong>open</strong></font> OUTPUT,<font color="#008000">&quot;&gt;<font color="#2040a0">$style</font>/<font color="#2040a0">$txt</font>&quot;</font> <strong>or</strong> <strong>die</strong> <font color="#008000">&quot;<font color="#2040a0">$!</font>&quot;</font>;
      <font color="a52a2a"><strong>binmode</strong></font> OUTPUT;
      <strong>if</strong> <font color="4444FF"><strong>(</strong></font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>2<font color="4444FF"><strong>]</strong></font><font color="4444FF"><strong>{</strong></font>OUTPUT<font color="4444FF"><strong>}</strong></font> <strong>eq</strong> <font color="#008000">'JPG'</font><font color="4444FF"><strong>)</strong></font>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="a52a2a"><strong>print</strong></font> OUTPUT <font color="#2040a0">$image</font>-&gt;jpeg;
      <font color="4444FF"><strong>}</strong></font>
      <strong>else</strong>
      <font color="4444FF"><strong>{</strong></font>
	  <font color="a52a2a"><strong>print</strong></font> OUTPUT <font color="#2040a0">$image</font>-&gt;png;
      <font color="4444FF"><strong>}</strong></font>
      <font color="a52a2a"><strong>close</strong></font> OUTPUT;
  <font color="4444FF"><strong>}</strong></font>
 
 <font color="#444444"># return the image
  </font><font color="#2040a0">$this</font>-&gt;<font color="4444FF"><strong>[</strong></font>3<font color="4444FF"><strong>]</strong></font> = <font color="#2040a0">$image</font>;
<font color="4444FF"><strong>}</strong></font>

1













</pre>
<hr>
syntax highlighted by <a href="http://www.cosy.sbg.ac.at/~ppalfrad/code2html">Code2HTML</a>, v. 0.8.12
</body>

<SCRIPT language="Javascript">
<!--

// FILE ARCHIVED ON 20010714034509 AND RETRIEVED FROM THE
// INTERNET ARCHIVE ON 20051214141303.
// JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.
// ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
// SECTION 108(a)(3)).

   var sWayBackCGI = "http://web.archive.org/web/20010714034509/";

   function xLateUrl(aCollection, sProp) {
      var i = 0;
      for(i = 0; i < aCollection.length; i++)
         if (aCollection[i][sProp].indexOf("mailto:") == -1 &&
             aCollection[i][sProp].indexOf("javascript:") == -1)
            aCollection[i][sProp] = sWayBackCGI + aCollection[i][sProp];
   }

   if (document.links)  xLateUrl(document.links, "href");
   if (document.images) xLateUrl(document.images, "src");
   if (document.embeds) xLateUrl(document.embeds, "src");

   if (document.body && document.body.background)
      document.body.background = sWayBackCGI + document.body.background;

//-->

</SCRIPT>
</html>
